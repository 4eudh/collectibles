<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collectible Code System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#ededfc',
                            100: '#d0d0f7',
                            200: '#a7a6ee',
                            300: '#8180e5',
                            400: '#7170e2',
                            500: '#5D5CDE',
                            600: '#4140d9',
                            700: '#2f2ec7',
                            800: '#2625a1',
                            900: '#1c1c78',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-slow': 'bounce 3s infinite',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes gradientShift {
            0% { background-position: 0% 50% }
            50% { background-position: 100% 50% }
            100% { background-position: 0% 50% }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes reveal {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes glitter {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.5; }
        }
        
        .rarity-common { 
            background: linear-gradient(135deg, #c0c0c0, #f0f0f0, #c0c0c0);
            background-size: 200% 200%;
            animation: gradientShift 6s ease infinite;
        }
        .rarity-uncommon { 
            background: linear-gradient(135deg, #84cc16, #bef264, #84cc16);
            background-size: 200% 200%;
            animation: gradientShift 6s ease infinite;
        }
        .rarity-rare { 
            background: linear-gradient(135deg, #2563eb, #60a5fa, #2563eb);
            background-size: 200% 200%;
            animation: gradientShift 6s ease infinite;
        }
        .rarity-epic { 
            background: linear-gradient(135deg, #9333ea, #c084fc, #9333ea);
            background-size: 200% 200%;
            animation: gradientShift 6s ease infinite;
        }
        .rarity-legendary { 
            background: linear-gradient(135deg, #f59e0b, #fcd34d, #f59e0b);
            background-size: 200% 200%;
            animation: gradientShift 5s ease infinite;
        }
        .rarity-mythic { 
            background: linear-gradient(135deg, #dc2626, #fca5a5, #dc2626);
            background-size: 200% 200%;
            animation: gradientShift 4s ease infinite;
        }
        
        .dark .rarity-common { 
            background: linear-gradient(135deg, #6b7280, #9ca3af, #6b7280);
            background-size: 200% 200%;
            animation: gradientShift 6s ease infinite;
        }
        .dark .rarity-uncommon { 
            background: linear-gradient(135deg, #65a30d, #a3e635, #65a30d);
            background-size: 200% 200%;
            animation: gradientShift 6s ease infinite;
        }
        .dark .rarity-rare { 
            background: linear-gradient(135deg, #1d4ed8, #3b82f6, #1d4ed8);
            background-size: 200% 200%;
            animation: gradientShift 6s ease infinite;
        }
        .dark .rarity-epic { 
            background: linear-gradient(135deg, #7e22ce, #a855f7, #7e22ce);
            background-size: 200% 200%;
            animation: gradientShift 6s ease infinite;
        }
        .dark .rarity-legendary { 
            background: linear-gradient(135deg, #d97706, #f59e0b, #d97706);
            background-size: 200% 200%;
            animation: gradientShift 5s ease infinite;
        }
        .dark .rarity-mythic { 
            background: linear-gradient(135deg, #b91c1c, #ef4444, #b91c1c);
            background-size: 200% 200%;
            animation: gradientShift 4s ease infinite;
        }
        
        .card-shine {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.1) 45%, 
                rgba(255,255,255,0.5) 50%, 
                rgba(255,255,255,0.1) 55%, 
                rgba(255,255,255,0) 100%
            );
            background-size: 200% 200%;
            background-position: 100% 100%;
            transition: background-position 0.5s ease-in-out;
            pointer-events: none;
            z-index: 2;
            border-radius: inherit;
        }
        
        .collectible-card:hover .card-shine {
            background-position: 0% 0%;
        }
        
        .collectible-card {
            transition: all 0.3s ease;
            animation: reveal 0.5s ease forwards;
        }
        
        .collectible-card:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .rarity-mythic .collectible-icon, .rarity-legendary .collectible-icon {
            animation: float 3s ease-in-out infinite;
        }
        
        .collectible-glitter {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            pointer-events: none;
            z-index: 3;
        }
        
        .rarity-legendary .collectible-glitter, .rarity-mythic .collectible-glitter {
            animation: glitter 1.5s ease-in-out infinite;
        }
        
        .glow {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 0 5px rgba(93, 92, 222, 0.3);
            }
            to {
                box-shadow: 0 0 20px rgba(93, 92, 222, 0.7);
            }
        }
        
        .collectible-icon {
            filter: drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease, filter 0.3s ease;
        }
        
        .collectible-card:hover .collectible-icon {
            filter: drop-shadow(0px 3px 5px rgba(0, 0, 0, 0.3));
            transform: scale(1.05);
        }
        
        .card-border {
            position: absolute;
            inset: 0;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(135deg, rgba(255,255,255,0.5), rgba(255,255,255,0.1));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
        }
        
        .rarity-badge {
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: capitalize;
        }
        
        .badge-common { 
            background-color: #f3f4f6; 
            color: #6b7280;
            border: 1px solid #d1d5db;
        }
        .badge-uncommon { 
            background-color: #ecfccb; 
            color: #65a30d;
            border: 1px solid #bef264;
        }
        .badge-rare { 
            background-color: #dbeafe; 
            color: #2563eb;
            border: 1px solid #93c5fd;
        }
        .badge-epic { 
            background-color: #f3e8ff; 
            color: #9333ea;
            border: 1px solid #d8b4fe;
        }
        .badge-legendary { 
            background-color: #fef3c7; 
            color: #d97706;
            border: 1px solid #fcd34d;
        }
        .badge-mythic { 
            background-color: #fee2e2; 
            color: #dc2626;
            border: 1px solid #fca5a5;
        }
        
        .dark .badge-common { 
            background-color: #374151; 
            color: #d1d5db;
            border: 1px solid #6b7280;
        }
        .dark .badge-uncommon { 
            background-color: #365314; 
            color: #a3e635;
            border: 1px solid #65a30d;
        }
        .dark .badge-rare { 
            background-color: #1e3a8a; 
            color: #60a5fa;
            border: 1px solid #2563eb;
        }
        .dark .badge-epic { 
            background-color: #581c87; 
            color: #c084fc;
            border: 1px solid #9333ea;
        }
        .dark .badge-legendary { 
            background-color: #78350f; 
            color: #fcd34d;
            border: 1px solid #d97706;
        }
        .dark .badge-mythic { 
            background-color: #7f1d1d; 
            color: #fca5a5;
            border: 1px solid #dc2626;
        }
        
        .redeemed-collectible {
            animation: redeemReveal 1s ease-in-out forwards;
            opacity: 0;
            transform: scale(0.8) translateY(20px);
        }
        
        @keyframes redeemReveal {
            0% { opacity: 0; transform: scale(0.8) translateY(20px); }
            60% { transform: scale(1.1) translateY(-10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        /* Emoji picker styles */
        .emoji-picker {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .emoji-category {
            margin-bottom: 0.5rem;
            border-bottom: 1px solid rgba(229, 231, 235, 0.5);
        }
        
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }
        
        .emoji-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .emoji-item:hover {
            background-color: rgba(243, 244, 246, 0.8);
        }
        
        .dark .emoji-item:hover {
            background-color: rgba(55, 65, 81, 0.8);
        }
        
        .emoji-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .emoji-name {
            font-size: 0.75rem;
            text-align: center;
            color: #6b7280;
        }
        
        .dark .emoji-name {
            color: #9ca3af;
        }
        
        .emoji-search {
            position: sticky;
            top: 0;
            background-color: white;
            padding: 0.5rem;
            z-index: 10;
        }
        
        .dark .emoji-search {
            background-color: #1f2937;
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 transition-colors duration-200">
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Loading Screen -->
        <div id="loadingScreen" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex items-center justify-center">
            <div class="text-center">
                <svg class="animate-spin h-12 w-12 text-primary-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Loading Collectibles System</h2>
            </div>
        </div>

        <!-- Authentication Screens -->
        <div id="authScreen" class="fixed inset-0 bg-white dark:bg-gray-900 z-40 flex-col items-center justify-center hidden">
            <div class="absolute top-4 right-4">
                <button id="darkModeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-800 dark:text-white hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-800 dark:text-white block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
            </div>
            
            <div class="max-w-md w-full mx-auto p-6">
                <div class="text-center mb-8">
                    <div class="inline-block p-4 rounded-full bg-primary-100 dark:bg-primary-900 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-primary-500" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5 5a3 3 0 015-2.236A3 3 0 0114.83 6H16a2 2 0 110 4h-5V9a1 1 0 10-2 0v1H4a2 2 0 110-4h1.17A3 3 0 015 5zm4 1V5a1 1 0 10-1 1h1zm3 0a1 1 0 10-1-1v1h1z" clip-rule="evenodd" />
                            <path d="M9 11H3v5a2 2 0 002 2h4v-7zM11 18h4a2 2 0 002-2v-5h-6v7z" />
                        </svg>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Collectible Realm</h1>
                    <p class="text-gray-600 dark:text-gray-400 mt-2">Unlock rare digital treasures</p>
                </div>
                
                <!-- Login Form -->
                <div id="loginForm" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-4">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Sign In</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="loginEmail" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
                            <input type="email" id="loginEmail" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white text-base focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div>
                            <label for="loginPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                            <input type="password" id="loginPassword" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white text-base focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <button id="loginButton" class="w-full bg-primary-500 text-white py-2 px-4 rounded-md hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors flex items-center justify-center">
                            <span id="loginButtonText">Sign In</span>
                            <div id="loginButtonSpinner" class="loading-spinner ml-2 hidden"></div>
                        </button>
                    </div>
                    <div class="mt-4 text-center text-sm">
                        <a href="#" id="showRegisterForm" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">Don't have an account? Register</a>
                    </div>
                </div>
                
                <!-- Register Form -->
                <div id="registerForm" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hidden">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Create Account</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="registerUsername" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Username</label>
                            <input type="text" id="registerUsername" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white text-base focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div>
                            <label for="registerEmail" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
                            <input type="email" id="registerEmail" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white text-base focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div>
                            <label for="registerPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                            <input type="password" id="registerPassword" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white text-base focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <button id="registerButton" class="w-full bg-primary-500 text-white py-2 px-4 rounded-md hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors flex items-center justify-center">
                            <span id="registerButtonText">Register</span>
                            <div id="registerButtonSpinner" class="loading-spinner ml-2 hidden"></div>
                        </button>
                    </div>
                    <div class="mt-4 text-center text-sm">
                        <a href="#" id="showLoginForm" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">Already have an account? Sign in</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-md">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5 5a3 3 0 015-2.236A3 3 0 0114.83 6H16a2 2 0 110 4h-5V9a1 1 0 10-2 0v1H4a2 2 0 110-4h1.17A3 3 0 015 5zm4 1V5a1 1 0 10-1 1h1zm3 0a1 1 0 10-1-1v1h1z" clip-rule="evenodd" />
                                <path d="M9 11H3v5a2 2 0 002 2h4v-7zM11 18h4a2 2 0 002-2v-5h-6v7z" />
                            </svg>
                            <h1 class="ml-2 text-xl font-bold text-gray-900 dark:text-white">Collectible Realm</h1>
                        </div>
                        <nav class="hidden md:ml-6 md:flex md:space-x-8">
                            <a href="#" id="nav-dashboard" class="border-primary-500 text-gray-900 dark:text-white hover:text-primary-500 dark:hover:text-primary-400 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Dashboard</a>
                            <a href="#" id="nav-collection" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">My Collection</a>
                            <a href="#" id="nav-redeem" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Redeem Code</a>
                        </nav>
                    </div>
                    <div class="hidden md:ml-6 md:flex md:items-center">
                        <button id="headerDarkModeToggle" class="p-1 rounded-full text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                            </svg>
                        </button>
                        <div class="ml-3 relative">
                            <div>
                                <button id="userMenuButton" class="bg-white dark:bg-gray-700 flex text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800" id="user-menu-button" aria-expanded="false" aria-haspopup="true">
                                    <span class="sr-only">Open user menu</span>
                                    <div class="h-8 w-8 rounded-full bg-primary-200 dark:bg-primary-800 flex items-center justify-center">
                                        <span id="userInitial" class="text-primary-700 dark:text-primary-300 font-medium">U</span>
                                    </div>
                                </button>
                            </div>
                            <div id="userMenu" class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-10" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                                <a href="#" id="menu-profile" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">Your Profile</a>
                                <a href="#" id="menu-settings" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">Settings</a>
                                <a href="#" id="menu-admin-panel" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 hidden" role="menuitem">Admin Panel</a>
                                <a href="#" id="menu-sign-out" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitem">Sign out</a>
                            </div>
                        </div>
                    </div>
                    <div class="-mr-2 flex items-center md:hidden">
                        <button id="mobileMenuButton" class="bg-white dark:bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 dark:text-gray-300 hover:text-gray-500 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500" aria-expanded="false">
                            <span class="sr-only">Open main menu</span>
                            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                            <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div id="mobileMenu" class="hidden md:hidden">
                <div class="pt-2 pb-3 space-y-1">
                    <a href="#" id="mobile-nav-dashboard" class="bg-primary-50 dark:bg-primary-900 border-primary-500 text-primary-700 dark:text-primary-300 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Dashboard</a>
                    <a href="#" id="mobile-nav-collection" class="border-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:text-gray-800 dark:hover:text-white block pl-3 pr-4 py-2 border-l-4 text-base font-medium">My Collection</a>
                    <a href="#" id="mobile-nav-redeem" class="border-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:text-gray-800 dark:hover:text-white block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Redeem Code</a>
                </div>
                <div class="pt-4 pb-3 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex items-center px-4">
                        <div class="flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-primary-200 dark:bg-primary-800 flex items-center justify-center">
                                <span id="mobileUserInitial" class="text-primary-700 dark:text-primary-300 font-medium">U</span>
                            </div>
                        </div>
                        <div class="ml-3">
                            <div id="mobileUsername" class="text-base font-medium text-gray-800 dark:text-white">User</div>
                            <div id="mobileUserEmail" class="text-sm font-medium text-gray-500 dark:text-gray-400">user@example.com</div>
                        </div>
                        <button id="mobileDarkModeToggle" class="ml-auto bg-gray-100 dark:bg-gray-700 flex-shrink-0 p-1 rounded-full text-gray-400 dark:text-gray-300 hover:text-gray-500 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                            </svg>
                        </button>
                    </div>
                    <div class="mt-3 space-y-1">
                        <a href="#" id="mobile-menu-profile" class="block px-4 py-2 text-base font-medium text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">Your Profile</a>
                        <a href="#" id="mobile-menu-settings" class="block px-4 py-2 text-base font-medium text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">Settings</a>
                        <a href="#" id="mobile-menu-admin-panel" class="block px-4 py-2 text-base font-medium text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 hidden">Admin Panel</a>
                        <a href="#" id="mobile-menu-sign-out" class="block px-4 py-2 text-base font-medium text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700">Sign out</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow">
            <!-- Dashboard -->
            <div id="dashboardView" class="py-6">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Dashboard</h1>
                    <div class="mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
                        <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg transition-all duration-300 hover:shadow-xl">
                            <div class="px-4 py-5 sm:p-6">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 bg-primary-100 dark:bg-primary-900 rounded-md p-3">
                                        <svg class="h-6 w-6 text-primary-600 dark:text-primary-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                                        </svg>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Total Collectibles</dt>
                                            <dd>
                                                <div id="totalCollectibles" class="text-lg font-medium text-gray-900 dark:text-white">0</div>
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg transition-all duration-300 hover:shadow-xl">
                            <div class="px-4 py-5 sm:p-6">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 bg-primary-100 dark:bg-primary-900 rounded-md p-3">
                                        <svg class="h-6 w-6 text-primary-600 dark:text-primary-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Collectibles Redeemed</dt>
                                            <dd>
                                                <div id="redeemedCollectibles" class="text-lg font-medium text-gray-900 dark:text-white">0</div>
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg transition-all duration-300 hover:shadow-xl">
                            <div class="px-4 py-5 sm:p-6">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 bg-primary-100 dark:bg-primary-900 rounded-md p-3">
                                        <svg class="h-6 w-6 text-primary-600 dark:text-primary-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                                        </svg>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Rarest Collectible</dt>
                                            <dd>
                                                <div id="rarestCollectible" class="text-lg font-medium text-gray-900 dark:text-white">None</div>
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h2 class="text-lg font-medium text-gray-900 dark:text-white">Recent Activity</h2>
                        <div class="mt-2 bg-white dark:bg-gray-800 shadow overflow-hidden rounded-lg">
                            <ul id="activityFeed" class="divide-y divide-gray-200 dark:divide-gray-700">
                                <li class="px-4 py-4 flex text-gray-500 dark:text-gray-400 italic">No recent activity to display</li>
                            </ul>
                        </div>
                    </div>

                    <div class="mt-8">
                        <h2 class="text-lg font-medium text-gray-900 dark:text-white">Featured Collectibles</h2>
                        <div class="mt-4 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
                            <div id="featuredCollectibles" class="col-span-full text-center p-8 text-gray-500 dark:text-gray-400 italic">
                                No featured collectibles to display
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Collection View -->
            <div id="collectionView" class="py-6 hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">My Collection</h1>
                            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Browse all your collected items</p>
                        </div>
                        <div class="mt-4 md:mt-0">
                            <div class="flex items-center space-x-2">
                                <label for="collectionFilterRarity" class="text-sm font-medium text-gray-700 dark:text-gray-300">Filter:</label>
                                <select id="collectionFilterRarity" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm">
                                    <option value="all">All Rarities</option>
                                    <option value="common">Common</option>
                                    <option value="uncommon">Uncommon</option>
                                    <option value="rare">Rare</option>
                                    <option value="epic">Epic</option>
                                    <option value="legendary">Legendary</option>
                                    <option value="mythic">Mythic</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6">
                        <div id="collectionStats" class="grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-3">
                                    <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Common</div>
                                    <div class="mt-1 text-lg font-semibold text-gray-900 dark:text-white">0</div>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-3">
                                    <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Uncommon</div>
                                    <div class="mt-1 text-lg font-semibold text-gray-900 dark:text-white">0</div>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-3">
                                    <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Rare</div>
                                    <div class="mt-1 text-lg font-semibold text-gray-900 dark:text-white">0</div>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-3">
                                    <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Epic</div>
                                    <div class="mt-1 text-lg font-semibold text-gray-900 dark:text-white">0</div>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-3">
                                    <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Legendary</div>
                                    <div class="mt-1 text-lg font-semibold text-gray-900 dark:text-white">0</div>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-3">
                                    <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Mythic</div>
                                    <div class="mt-1 text-lg font-semibold text-gray-900 dark:text-white">0</div>
                                </div>
                            </div>
                        </div>

                        <div id="collectionGrid" class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
                            <div class="col-span-full text-center p-8 text-gray-500 dark:text-gray-400 italic">
                                Your collection is empty. Redeem a code to get started!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Redeem Code View -->
            <div id="redeemCodeView" class="py-6 hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Redeem Code</h1>
                    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Enter a code to add items to your collection</p>
                    
                    <div class="mt-6 bg-white dark:bg-gray-800 shadow overflow-hidden rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="max-w-xl mx-auto">
                                <div class="flex flex-col space-y-4">
                                    <label for="redeemCode" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Redemption Code</label>
                                    <div class="mt-1 flex rounded-md shadow-sm">
                                        <input type="text" id="redeemCode" class="focus:ring-primary-500 focus:border-primary-500 flex-1 block w-full rounded-md sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-base" placeholder="Enter your code here">
                                    </div>
                                    <div>
                                        <button id="redeemCodeButton" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800">
                                            <span id="redeemCodeButtonText">Redeem Code</span>
                                            <div id="redeemCodeButtonSpinner" class="loading-spinner ml-2 hidden"></div>
                                        </button>
                                    </div>
                                    <div id="redeemResult" class="hidden mt-4 p-4 rounded-md"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h2 class="text-lg font-medium text-gray-900 dark:text-white">Redemption History</h2>
                        <div class="mt-2 bg-white dark:bg-gray-800 shadow overflow-hidden rounded-lg">
                            <div class="shadow overflow-hidden border-b border-gray-200 dark:border-gray-700 sm:rounded-lg">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-900">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Date</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Items</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Rarity</th>
                                        </tr>
                                    </thead>
                                    <tbody id="redemptionHistory" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <tr>
                                            <td colspan="3" class="px-6 py-4 whitespace-nowrap text-center text-gray-500 dark:text-gray-400 italic">No redemption history</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanelView" class="py-6 hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Admin Panel</h1>
                            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Manage codes, collectibles, and users</p>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg">
                            <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
                                <div>
                                    <h2 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Redemption Codes</h2>
                                    <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Create and manage redemption codes</p>
                                </div>
                                <button id="createCodeButton" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800">
                                    Create New Code
                                </button>
                            </div>
                            <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:px-6">
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-900">
                                            <tr>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Code</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Item</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Rarity</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Expires</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="codesTable" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <tr>
                                                <td colspan="6" class="px-6 py-4 whitespace-nowrap text-center text-gray-500 dark:text-gray-400 italic">No codes created yet</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg">
                            <div class="px-4 py-5 sm:px-6">
                                <h2 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">User Management</h2>
                                <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">View and manage user accounts</p>
                            </div>
                            <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:px-6">
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-900">
                                            <tr>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Username</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Email</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Role</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Collectibles</th>
                                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="usersTable" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <tr>
                                                <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-gray-500 dark:text-gray-400 italic">No users found</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile View -->
            <div id="profileView" class="py-6 hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Your Profile</h1>
                    
                    <div class="mt-6 bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg">
                        <div class="px-4 py-5 sm:px-6 flex items-center justify-between">
                            <div>
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Profile Information</h3>
                                <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Personal details and preferences</p>
                            </div>
                            <div class="h-16 w-16 rounded-full bg-primary-200 dark:bg-primary-800 flex items-center justify-center">
                                <span id="profileUserInitial" class="text-primary-700 dark:text-primary-300 text-2xl font-medium">U</span>
                            </div>
                        </div>
                        <div class="border-t border-gray-200 dark:border-gray-700">
                            <dl>
                                <div class="bg-gray-50 dark:bg-gray-900 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Username</dt>
                                    <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2" id="profileUsername">-</dd>
                                </div>
                                <div class="bg-white dark:bg-gray-800 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Email address</dt>
                                    <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2" id="profileEmail">-</dd>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-900 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Role</dt>
                                    <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2" id="profileRole">-</dd>
                                </div>
                                <div class="bg-white dark:bg-gray-800 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Collectibles</dt>
                                    <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2" id="profileCollectibles">0</dd>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-900 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Account created</dt>
                                    <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2" id="profileCreatedAt">-</dd>
                                </div>
                            </dl>
                        </div>
                    </div>

                    <div class="mt-6 bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg">
                        <div class="px-4 py-5 sm:px-6">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Update Profile</h3>
                            <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Update your personal information</p>
                        </div>
                        <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:px-6">
                            <div class="space-y-6">
                                <div>
                                    <label for="updateUsername" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Username</label>
                                    <input type="text" id="updateUsername" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white text-base focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <button id="updateProfileButton" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800">
                                        <span id="updateProfileButtonText">Update Profile</span>
                                        <div id="updateProfileButtonSpinner" class="loading-spinner ml-2 hidden"></div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settingsView" class="py-6 hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Settings</h1>
                    
                    <div class="mt-6 bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg">
                        <div class="px-4 py-5 sm:px-6">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Appearance</h3>
                            <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Customize your viewing experience</p>
                        </div>
                        <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:px-6">
                            <div class="space-y-6">
                                <div class="flex items-center justify-between">
                                    <span class="flex-1 text-sm font-medium text-gray-700 dark:text-gray-300">Dark Mode</span>
                                    <button id="settingsDarkModeToggle" class="relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                        <span class="sr-only">Use dark mode</span>
                                        <span aria-hidden="true" class="pointer-events-none inline-block h-5 w-5 rounded-full bg-white dark:bg-gray-300 shadow transform ring-0 transition ease-in-out duration-200"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg">
                        <div class="px-4 py-5 sm:px-6">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Data Management</h3>
                            <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Manage your account data</p>
                        </div>
                        <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:px-6">
                            <div class="space-y-6">
                                <div>
                                    <button id="exportDataButton" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800">
                                        Export Your Data
                                    </button>
                                </div>
                                <div>
                                    <button id="clearDataButton" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 dark:focus:ring-offset-gray-800">
                                        Clear All Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Modals -->
        <div id="createCodeModal" class="fixed inset-0 overflow-y-auto hidden z-50">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                    <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-primary-100 dark:bg-primary-900 sm:mx-0 sm:h-10 sm:w-10">
                                <svg class="h-6 w-6 text-primary-600 dark:text-primary-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                </svg>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="modal-title">
                                    Create New Redemption Code
                                </h3>
                                <div class="mt-4 space-y-4">
                                    <div>
                                        <label for="codeInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Code</label>
                                        <div class="mt-1 relative rounded-md shadow-sm">
                                            <input type="text" id="codeInput" class="focus:ring-primary-500 focus:border-primary-500 block w-full pr-16 sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md text-base" placeholder="Enter code or generate">
                                            <div class="absolute inset-y-0 right-0 flex items-center">
                                                <button id="generateCodeButton" class="h-full px-2 py-0 border border-transparent text-sm font-medium rounded-r-md text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900 hover:bg-primary-200 dark:hover:bg-primary-800">
                                                    Generate
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="itemNameInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Item Name</label>
                                        <input type="text" id="itemNameInput" class="mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md text-base" placeholder="Enter item name">
                                    </div>
                                    <div>
                                        <label for="itemCategorySelect" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Item Category</label>
                                        <select id="itemCategorySelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:text-white">
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Emoji</label>
                                        <div class="relative">
                                            <div class="emoji-search mb-2">
                                                <input type="text" id="emojiSearch" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white text-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500" placeholder="Search emojis...">
                                            </div>
                                            <div id="emojiPicker" class="emoji-picker border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 p-2">
                                                <!-- Emoji categories and selections will go here -->
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="itemRaritySelect" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Rarity</label>
                                        <select id="itemRaritySelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:text-white">
                                            <option value="common">Common</option>
                                            <option value="uncommon">Uncommon</option>
                                            <option value="rare">Rare</option>
                                            <option value="epic">Epic</option>
                                            <option value="legendary">Legendary</option>
                                            <option value="mythic">Mythic</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="expirationDateInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Expiration Date (Optional)</label>
                                        <input type="date" id="expirationDateInput" class="mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md text-base">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="bg-gray-100 dark:bg-gray-900 p-3 rounded-lg">
                                        <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">Item Preview:</p>
                                        <div id="itemPreview" class="w-full flex justify-center">
                                            <div class="collectible-card relative w-32 h-40 rounded-lg overflow-hidden shadow-md">
                                                <div class="absolute inset-0 rarity-common"></div>
                                                <div class="card-shine"></div>
                                                <div class="card-border"></div>
                                                <div class="relative flex flex-col items-center justify-center h-full p-2">
                                                    <div class="w-16 h-16 bg-white dark:bg-gray-700 rounded-full flex items-center justify-center">
                                                        <div class="collectible-icon text-center text-3xl">
                                                            🛡️
                                                        </div>
                                                    </div>
                                                    <div class="mt-2 text-center">
                                                        <div class="font-medium text-xs text-gray-900 dark:text-white truncate max-w-full">Shield</div>
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                                            <span class="badge-common rarity-badge">Common</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-900 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button id="createCodeConfirmButton" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm">
                            <span id="createCodeConfirmButtonText">Create</span>
                            <div id="createCodeConfirmButtonSpinner" class="loading-spinner ml-2 hidden"></div>
                        </button>
                        <button id="createCodeCancelButton" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="collectibleDetailModal" class="fixed inset-0 overflow-y-auto hidden z-50">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                    <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div id="collectibleDetailContent" class="flex flex-col items-center">
                            <!-- Content will be dynamically populated -->
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-900 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button id="collectibleDetailCloseButton" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:w-auto sm:text-sm">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="confirmationModal" class="fixed inset-0 overflow-y-auto hidden z-50">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                    <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900 sm:mx-0 sm:h-10 sm:w-10">
                                <svg class="h-6 w-6 text-red-600 dark:text-red-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="confirmation-modal-title">
                                    Delete Item
                                </h3>
                                <div class="mt-2">
                                    <p class="text-sm text-gray-500 dark:text-gray-400" id="confirmation-modal-message">
                                        Are you sure you want to delete this item? This action cannot be undone.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-900 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button id="confirmActionButton" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Delete
                        </button>
                        <button id="cancelActionButton" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="notificationContainer" class="fixed inset-x-0 top-0 flex items-end justify-center px-4 py-6 pointer-events-none sm:p-6 sm:items-start sm:justify-end z-50">
            <!-- Notifications will be dynamically added here -->
        </div>
    </div>

    <script>
        // REPLACE THESE WITH YOUR ACTUAL SUPABASE CREDENTIALS
        const SUPABASE_URL = 'https://pipaigpzmbdymsxgvgwa.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpcGFpZ3B6bWJkeW1zeGd2Z3dhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzNTYzMDEsImV4cCI6MjA2NDkzMjMwMX0.SHA-bOF5Z2q9vWf571AUerZy_-_F2XeV-l-mn6fvcLU';

        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Emoji categories and options for collectibles
        const emojiCategories = {
            "Weapons & Combat": [
                { name: "Sword", emoji: "⚔️", value: "sword" },
                { name: "Shield", emoji: "🛡️", value: "shield" },
                { name: "Bow & Arrow", emoji: "🏹", value: "bow" },
                { name: "Axe", emoji: "🪓", value: "axe" },
                { name: "Dagger", emoji: "🗡️", value: "dagger" },
                { name: "Crossbow", emoji: "🏹", value: "crossbow" },
                { name: "Hammer", emoji: "🔨", value: "hammer" }
            ],
            "Magic & Mystical": [
                { name: "Crystal Ball", emoji: "🔮", value: "crystal_ball" },
                { name: "Magic Wand", emoji: "🪄", value: "wand" },
                { name: "Spell Book", emoji: "📕", value: "book" },
                { name: "Potion", emoji: "🧪", value: "potion" },
                { name: "Sparkles", emoji: "✨", value: "sparkles" },
                { name: "Staff", emoji: "🧙‍♂️", value: "staff" }
            ],
            "Treasures & Valuables": [
                { name: "Crown", emoji: "👑", value: "crown" },
                { name: "Gem Stone", emoji: "💎", value: "gem" },
                { name: "Coin", emoji: "🪙", value: "coin" },
                { name: "Money Bag", emoji: "💰", value: "money_bag" },
                { name: "Ring", emoji: "💍", value: "ring" },
                { name: "Trophy", emoji: "🏆", value: "trophy" }
            ],
            "Clothing & Accessories": [
                { name: "Armor", emoji: "🥋", value: "armor" },
                { name: "Helmet", emoji: "⛑️", value: "helmet" },
                { name: "Boots", emoji: "👢", value: "boots" },
                { name: "Gloves", emoji: "🧤", value: "gloves" },
                { name: "Pendant", emoji: "📿", value: "pendant" },
                { name: "Smiley", emoji: "😊", value: "smiley" },
                { name: "Amulet", emoji: "🧿", value: "amulet" }
            ],
            "Artifacts & Items": [
                { name: "Scroll", emoji: "📜", value: "scroll" },
                { name: "Treasure Chest", emoji: "🧰", value: "chest" },
                { name: "Key", emoji: "🔑", value: "key" },
                { name: "Hourglass", emoji: "⌛", value: "hourglass" },
                { name: "Compass", emoji: "🧭", value: "compass" },
                { name: "Torch", emoji: "🔦", value: "torch" }
            ],
            "Creatures & Mythical": [
                { name: "Dragon", emoji: "🐉", value: "dragon" },
                { name: "Unicorn", emoji: "🦄", value: "unicorn" },
                { name: "Phoenix", emoji: "🦅", value: "phoenix" },
                { name: "Mermaid", emoji: "🧜‍♀️", value: "mermaid" },
                { name: "Ghost", emoji: "👻", value: "ghost" },
                { name: "Alien", emoji: "👽", value: "alien" }
            ],
            "Nature & Elements": [
                { name: "Fire", emoji: "🔥", value: "fire" },
                { name: "Water", emoji: "💧", value: "water" },
                { name: "Lightning", emoji: "⚡", value: "lightning" },
                { name: "Leaf", emoji: "🍃", value: "leaf" },
                { name: "Skull", emoji: "💀", value: "skull" },
                { name: "Rock", emoji: "🪨", value: "rock" }
            ],
            "Food & Potions": [
                { name: "Apple", emoji: "🍎", value: "apple" },
                { name: "Bread", emoji: "🍞", value: "bread" },
                { name: "Cheese", emoji: "🧀", value: "cheese" },
                { name: "Meat", emoji: "🍖", value: "meat" },
                { name: "Mushroom", emoji: "🍄", value: "mushroom" },
                { name: "Elixir", emoji: "🧴", value: "elixir" }
            ]
        };
        
        // Helper function to get emoji by value
        function getEmojiByValue(value) {
            for (const category in emojiCategories) {
                const emoji = emojiCategories[category].find(e => e.value === value);
                if (emoji) return emoji.emoji;
            }
            return "❓"; // Default fallback emoji
        }
        
        // Function to render emoji as HTML
        function renderEmoji(value, size = 'text-3xl') {
            return `<span class="${size} emoji-icon">${getEmojiByValue(value)}</span>`;
        }

        // Initialize dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Main application state
        const appState = {
            currentUser: null,
            userProfile: null,
            codes: [],
            collectibles: [],
            currentView: 'dashboard',
            isAdmin: false,
            activities: [],
            redemptionHistory: [],
            users: []
        };

        // Utility functions
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function showNotification(message, type = 'success') {
            const id = Date.now().toString();
            const colors = type === 'success' ? 
                'bg-green-50 dark:bg-green-900 text-green-800 dark:text-green-100' : 
                'bg-red-50 dark:bg-red-900 text-red-800 dark:text-red-100';
            
            const iconColors = type === 'success' ? 
                'text-green-400 dark:text-green-300' : 
                'text-red-400 dark:text-red-300';
            
            const icon = type === 'success' ? 
                `<svg class="h-5 w-5 ${iconColors}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>` : 
                `<svg class="h-5 w-5 ${iconColors}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>`;
            
            const notification = document.createElement('div');
            notification.id = `notification-${id}`;
            notification.className = `max-w-sm w-full ${colors} shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden transform transition-all duration-300 ease-in-out translate-y-2 opacity-0`;
            notification.innerHTML = `
                <div class="p-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            ${icon}
                        </div>
                        <div class="ml-3 w-0 flex-1 pt-0.5">
                            <p class="text-sm font-medium">${message}</p>
                        </div>
                        <div class="ml-4 flex-shrink-0 flex">
                            <button class="bg-transparent rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                <span class="sr-only">Close</span>
                                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            const container = document.getElementById('notificationContainer');
            container.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-y-2', 'opacity-0');
            }, 10);
            
            // Remove after duration
            setTimeout(() => {
                notification.classList.add('translate-y-2', 'opacity-0');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
            
            // Handle close button
            notification.querySelector('button').addEventListener('click', () => {
                notification.classList.add('translate-y-2', 'opacity-0');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            });
        }

        function showConfirmation(title, message, confirmText, callback) {
            const modalTitle = document.getElementById('confirmation-modal-title');
            const modalMessage = document.getElementById('confirmation-modal-message');
            const confirmButton = document.getElementById('confirmActionButton');
            
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            confirmButton.textContent = confirmText;
            
            document.getElementById('confirmationModal').classList.remove('hidden');
            
            const handleConfirm = () => {
                callback();
                document.getElementById('confirmationModal').classList.add('hidden');
                confirmButton.removeEventListener('click', handleConfirm);
            };
            
            confirmButton.addEventListener('click', handleConfirm);
            
            document.getElementById('cancelActionButton').addEventListener('click', function() {
                document.getElementById('confirmationModal').classList.add('hidden');
                confirmButton.removeEventListener('click', handleConfirm);
            }, { once: true });
        }

        // Supabase API functions
        async function createUserProfile(user, username) {
            try {
                const { data, error } = await supabase
                    .from('user_profiles')
                    .insert([
                        { id: user.id, username: username }
                    ]);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error creating user profile:', error.message);
                throw error;
            }
        }

        async function getUserProfile(userId) {
            try {
                const { data, error } = await supabase
                    .from('user_profiles')
                    .select('*')
                    .eq('id', userId)
                    .single();
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error getting user profile:', error.message);
                throw error;
            }
        }

        async function updateUserProfile(userId, updates) {
            try {
                const { data, error } = await supabase
                    .from('user_profiles')
                    .update(updates)
                    .eq('id', userId);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error updating user profile:', error.message);
                throw error;
            }
        }

        async function getAllUsers() {
            try {
                const { data, error } = await supabase
                    .from('user_profiles')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Error getting users:', error.message);
                return [];
            }
        }

        async function loadCodes() {
            try {
                const { data, error } = await supabase
                    .from('redemption_codes')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Error loading codes:', error.message);
                return [];
            }
        }

        async function createCode(codeData) {
            try {
                const { data, error } = await supabase
                    .from('redemption_codes')
                    .insert([{
                        ...codeData,
                        created_by: appState.currentUser.id
                    }]);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error creating code:', error.message);
                throw error;
            }
        }

        async function updateCode(codeId, updates) {
            try {
                const { data, error } = await supabase
                    .from('redemption_codes')
                    .update(updates)
                    .eq('id', codeId);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error updating code:', error.message);
                throw error;
            }
        }

        async function deleteCode(codeId) {
            try {
                const { data, error } = await supabase
                    .from('redemption_codes')
                    .delete()
                    .eq('id', codeId);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error deleting code:', error.message);
                throw error;
            }
        }

        async function loadUserCollectibles(userId) {
            try {
                const { data, error } = await supabase
                    .from('collectibles')
                    .select('*')
                    .eq('user_id', userId)
                    .order('acquired_date', { ascending: false });
                
                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Error loading collectibles:', error.message);
                return [];
            }
        }

        async function createCollectible(collectibleData) {
            try {
                const { data, error } = await supabase
                    .from('collectibles')
                    .insert([collectibleData]);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error creating collectible:', error.message);
                throw error;
            }
        }

        async function loadUserActivities(userId) {
            try {
                const { data, error } = await supabase
                    .from('activities')
                    .select('*')
                    .eq('user_id', userId)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Error loading activities:', error.message);
                return [];
            }
        }

        async function createActivity(activityData) {
            try {
                const { data, error } = await supabase
                    .from('activities')
                    .insert([activityData]);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error creating activity:', error.message);
                throw error;
            }
        }

        async function loadUserRedemptionHistory(userId) {
            try {
                const { data, error } = await supabase
                    .from('redemption_history')
                    .select('*')
                    .eq('user_id', userId)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Error loading redemption history:', error.message);
                return [];
            }
        }

        async function createRedemptionHistory(redemptionData) {
            try {
                const { data, error } = await supabase
                    .from('redemption_history')
                    .insert([redemptionData]);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error creating redemption history:', error.message);
                throw error;
            }
        }

        // UI Rendering Functions
        function renderUserCollectionStats() {
            if (!appState.currentUser) return;
            
            const collectibles = appState.collectibles;
            const statsContainer = document.getElementById('collectionStats');
            const statsRows = statsContainer.querySelectorAll('div.bg-white');
            
            const rarities = ['common', 'uncommon', 'rare', 'epic', 'legendary', 'mythic'];
            const counts = {};
            
            rarities.forEach(rarity => {
                counts[rarity] = collectibles.filter(c => c.rarity === rarity).length;
            });
            
            rarities.forEach((rarity, index) => {
                if (statsRows[index]) {
                    statsRows[index].querySelector('div.text-lg').textContent = counts[rarity];
                }
            });
        }

        function renderCollection(filter = 'all') {
            if (!appState.currentUser) return;
            
            const collectibles = appState.collectibles;
            const filteredCollectibles = filter === 'all' ? collectibles : collectibles.filter(c => c.rarity === filter);
            const collectionGrid = document.getElementById('collectionGrid');
            
            if (filteredCollectibles.length === 0) {
                if (filter === 'all') {
                    collectionGrid.innerHTML = `
                        <div class="col-span-full text-center p-8 text-gray-500 dark:text-gray-400 italic">
                            Your collection is empty. Redeem a code to get started!
                        </div>
                    `;
                } else {
                    collectionGrid.innerHTML = `
                        <div class="col-span-full text-center p-8 text-gray-500 dark:text-gray-400 italic">
                            You don't have any ${filter} items in your collection.
                        </div>
                    `;
                }
                return;
            }
            
            collectionGrid.innerHTML = '';
            
            filteredCollectibles.forEach(item => {
                // Create glitter elements for legendary and mythic items
                let glitterHtml = '';
                if (item.rarity === 'legendary' || item.rarity === 'mythic') {
                    // Add several glitter dots
                    for (let i = 0; i < 5; i++) {
                        const top = Math.floor(Math.random() * 80) + 10;
                        const left = Math.floor(Math.random() * 80) + 10;
                        const delay = Math.random() * 2;
                        glitterHtml += `<div class="collectible-glitter" style="top: ${top}%; left: ${left}%; animation-delay: ${delay}s"></div>`;
                    }
                }
                
                const div = document.createElement('div');
                div.className = 'collectible-card relative bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-lg transition-transform transform hover:scale-105 cursor-pointer';
                div.setAttribute('data-item-id', item.id);
                
                div.innerHTML = `
                    <div class="absolute inset-0 rarity-${item.rarity}"></div>
                    <div class="card-shine"></div>
                    <div class="card-border"></div>
                    ${glitterHtml}
                    <div class="relative p-4 flex flex-col items-center">
                        <div class="w-24 h-24 bg-white dark:bg-gray-700 rounded-full flex items-center justify-center mb-4 shadow-lg">
                            <div class="collectible-icon text-center text-4xl">
                                ${getEmojiByValue(item.item_graphic)}
                            </div>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">${item.item_name}</h3>
                        <div class="mb-3">
                            <span class="badge-${item.rarity} rarity-badge">${item.rarity}</span>
                        </div>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-2">Acquired: ${formatDate(item.acquired_date)}</p>
                    </div>
                `;
                
                collectionGrid.appendChild(div);
                
                div.addEventListener('click', () => {
                    showCollectibleDetail(item);
                });
            });
        }

        function showCollectibleDetail(item) {
            const detailContent = document.getElementById('collectibleDetailContent');
            
            // Create glitter elements for legendary and mythic items
            let glitterHtml = '';
            if (item.rarity === 'legendary' || item.rarity === 'mythic') {
                // Add several glitter dots
                for (let i = 0; i < 8; i++) {
                    const top = Math.floor(Math.random() * 80) + 10;
                    const left = Math.floor(Math.random() * 80) + 10;
                    const delay = Math.random() * 2;
                    glitterHtml += `<div class="collectible-glitter" style="top: ${top}%; left: ${left}%; animation-delay: ${delay}s"></div>`;
                }
            }
            
            detailContent.innerHTML = `
                <div class="w-full max-w-xs mx-auto">
                    <div class="collectible-card relative bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-lg">
                        <div class="absolute inset-0 rarity-${item.rarity}"></div>
                        <div class="card-shine"></div>
                        <div class="card-border"></div>
                        ${glitterHtml}
                        <div class="relative p-6 flex flex-col items-center">
                            <div class="w-32 h-32 bg-white dark:bg-gray-700 rounded-full flex items-center justify-center mb-6 shadow-lg">
                                <div class="collectible-icon text-center text-5xl">
                                    ${getEmojiByValue(item.item_graphic)}
                                </div>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">${item.item_name}</h2>
                            <div class="mb-4">
                                <span class="badge-${item.rarity} rarity-badge px-3 py-1">${item.rarity}</span>
                            </div>
                            <div class="w-full mt-4">
                                <div class="flex justify-between py-2 border-b border-gray-200 dark:border-gray-700">
                                    <span class="text-gray-500 dark:text-gray-400">Acquired</span>
                                    <span class="text-gray-900 dark:text-white">${formatDate(item.acquired_date)}</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-200 dark:border-gray-700">
                                    <span class="text-gray-500 dark:text-gray-400">Type</span>
                                    <span class="text-gray-900 dark:text-white capitalize">${item.item_graphic.replace('_', ' ')}</span>
                                </div>
                                <div class="flex justify-between py-2">
                                    <span class="text-gray-500 dark:text-gray-400">Collection ID</span>
                                    <span class="text-gray-900 dark:text-white">#${item.id.substring(item.id.length - 6).toUpperCase()}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('collectibleDetailModal').classList.remove('hidden');
        }

        async function updateDashboardStats() {
            if (!appState.currentUser) return;
            
            const collectibles = appState.collectibles;
            document.getElementById('totalCollectibles').textContent = collectibles.length;
            document.getElementById('redeemedCollectibles').textContent = collectibles.length;
            
            // Find rarest collectible
            const rarityOrder = {
                'common': 1,
                'uncommon': 2,
                'rare': 3,
                'epic': 4,
                'legendary': 5,
                'mythic': 6
            };
            
            let rarestCollectible = null;
            let highestRarity = 0;
            
            collectibles.forEach(item => {
                if (rarityOrder[item.rarity] > highestRarity) {
                    highestRarity = rarityOrder[item.rarity];
                    rarestCollectible = item;
                }
            });
            
            if (rarestCollectible) {
                document.getElementById('rarestCollectible').textContent = `${rarestCollectible.item_name} (${rarestCollectible.rarity})`;
            } else {
                document.getElementById('rarestCollectible').textContent = 'None';
            }
        }

        function renderActivityFeed() {
            if (!appState.currentUser) return;
            
            const userActivities = appState.activities;
            const activityFeed = document.getElementById('activityFeed');
            
            if (userActivities.length === 0) {
                activityFeed.innerHTML = `
                    <li class="px-4 py-4 flex text-gray-500 dark:text-gray-400 italic">No recent activity to display</li>
                `;
                return;
            }
            
            activityFeed.innerHTML = '';
            
            // Take only the 5 most recent
            const recentActivities = userActivities.slice(0, 5);
            
            recentActivities.forEach(activity => {
                const li = document.createElement('li');
                li.className = 'px-4 py-3 sm:px-6 transition-colors duration-150 hover:bg-gray-50 dark:hover:bg-gray-700';
                
                li.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center shadow-sm">
                                    <svg class="h-6 w-6 text-primary-600 dark:text-primary-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300">
                                    You ${activity.action} a <span class="badge-${activity.item_rarity} rarity-badge">${activity.item_rarity}</span> item: <span class="font-medium text-gray-900 dark:text-white">${activity.item_name}</span>
                                </p>
                            </div>
                        </div>
                        <div class="ml-4 flex-shrink-0">
                            <span class="text-sm text-gray-500 dark:text-gray-400">${formatDate(activity.created_at)}</span>
                        </div>
                    </div>
                `;
                
                activityFeed.appendChild(li);
            });
        }

        function renderFeaturedCollectibles() {
            const featuredContainer = document.getElementById('featuredCollectibles');
            
            if (!appState.isAdmin) {
                featuredContainer.innerHTML = `
                    <div class="col-span-full flex flex-col sm:flex-row gap-6 justify-center">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl transform hover:scale-105">
                            <div class="p-6 flex flex-col items-center text-center">
                                <div class="w-20 h-20 bg-primary-100 dark:bg-primary-900 rounded-full flex items-center justify-center mb-4">
                                    <svg class="h-10 w-10 text-primary-600 dark:text-primary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                    </svg>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Redeem a Code</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-4">Enter a redemption code to unlock exclusive collectibles!</p>
                                <button onclick="switchView('redeemCode')" class="w-full py-2 px-4 bg-primary-600 hover:bg-primary-700 text-white rounded-md transition-colors">
                                    Enter Code
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl transform hover:scale-105">
                            <div class="p-6 flex flex-col items-center text-center">
                                <div class="w-20 h-20 bg-primary-100 dark:bg-primary-900 rounded-full flex items-center justify-center mb-4">
                                    <svg class="h-10 w-10 text-primary-600 dark:text-primary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                    </svg>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">View Collection</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-4">Browse your impressive collection of rare items</p>
                                <button onclick="switchView('collection')" class="w-full py-2 px-4 bg-primary-600 hover:bg-primary-700 text-white rounded-md transition-colors">
                                    View Collection
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            if (appState.codes.length === 0) {
                featuredContainer.innerHTML = `
                    <div class="col-span-full text-center p-8 text-gray-500 dark:text-gray-400 italic">
                        No featured collectibles to display
                    </div>
                `;
                return;
            }
            
            featuredContainer.innerHTML = '';
            
            const activeCodes = appState.codes.filter(code => code.is_active);
            
            if (activeCodes.length === 0) {
                featuredContainer.innerHTML = `
                    <div class="col-span-full text-center p-8 text-gray-500 dark:text-gray-400 italic">
                        No featured collectibles to display
                    </div>
                `;
                return;
            }
            
            const featuresToShow = activeCodes.slice(0, 3);
            
            featuresToShow.forEach(item => {
                let glitterHtml = '';
                if (item.rarity === 'legendary' || item.rarity === 'mythic') {
                    for (let i = 0; i < 5; i++) {
                        const top = Math.floor(Math.random() * 80) + 10;
                        const left = Math.floor(Math.random() * 80) + 10;
                        const delay = Math.random() * 2;
                        glitterHtml += `<div class="collectible-glitter" style="top: ${top}%; left: ${left}%; animation-delay: ${delay}s"></div>`;
                    }
                }
                
                const div = document.createElement('div');
                div.className = 'collectible-card relative bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-lg transform transition-all duration-300 hover:shadow-xl';
                
                div.innerHTML = `
                    <div class="absolute inset-0 rarity-${item.rarity}"></div>
                    <div class="card-shine"></div>
                    <div class="card-border"></div>
                    ${glitterHtml}
                    <div class="relative p-6 flex flex-col items-center">
                        <div class="absolute top-4 right-4 bg-primary-500 text-white text-xs px-2 py-1 rounded-full shadow-sm">Admin View</div>
                        <div class="w-24 h-24 bg-white dark:bg-gray-700 rounded-full flex items-center justify-center mb-4 shadow-lg">
                            <div class="collectible-icon text-center text-4xl">
                                ${getEmojiByValue(item.item_graphic)}
                            </div>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">${item.item_name}</h3>
                        <div class="mb-2">
                            <span class="badge-${item.rarity} rarity-badge">${item.rarity}</span>
                        </div>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Code: ${item.code}</p>
                        <div class="mt-4 w-full">
                            <button class="w-full py-2 px-4 bg-primary-600 hover:bg-primary-700 text-white rounded-md transition-colors redeemFeaturedButton" data-code-id="${item.id}">
                                Edit Code
                            </button>
                        </div>
                    </div>
                `;
                
                featuredContainer.appendChild(div);
            });
            
            document.querySelectorAll('.redeemFeaturedButton').forEach(button => {
                button.addEventListener('click', (e) => {
                    const codeId = e.target.getAttribute('data-code-id');
                    switchView('adminPanel');
                    
                    setTimeout(() => {
                        const editButtons = document.querySelectorAll('.editCodeButton');
                        for (const button of editButtons) {
                            const buttonCodeId = button.getAttribute('data-code-id');
                            if (buttonCodeId === codeId) {
                                button.click();
                                break;
                            }
                        }
                    }, 100);
                });
            });
        }

        function renderRedemptionHistory() {
            if (!appState.currentUser) return;
            
            const history = appState.redemptionHistory;
            const historyTable = document.getElementById('redemptionHistory');
            
            if (history.length === 0) {
                historyTable.innerHTML = `
                    <tr>
                        <td colspan="3" class="px-6 py-4 whitespace-nowrap text-center text-gray-500 dark:text-gray-400 italic">No redemption history</td>
                    </tr>
                `;
                return;
            }
            
            historyTable.innerHTML = '';
            
            history.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">${formatDate(item.created_at)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${item.items.join(', ')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                        <span class="badge-${item.rarity} rarity-badge">${item.rarity}</span>
                    </td>
                `;
                
                historyTable.appendChild(tr);
            });
        }

        async function renderAdminCodes() {
            const codesTable = document.getElementById('codesTable');
            
            if (appState.codes.length === 0) {
                codesTable.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 whitespace-nowrap text-center text-gray-500 dark:text-gray-400 italic">No codes created yet</td>
                    </tr>
                `;
                return;
            }
            
            codesTable.innerHTML = '';
            
            appState.codes.forEach(code => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
                
                const isExpired = code.expiration_date && new Date(code.expiration_date) < new Date();
                const statusClass = !code.is_active ? 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200' : 
                                    isExpired ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200' : 
                                    'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200';
                
                const statusText = !code.is_active ? 'Inactive' : 
                                isExpired ? 'Expired' : 
                                'Active';
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${code.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">${code.item_name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                        <span class="badge-${code.rarity} rarity-badge">${code.rarity}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">${code.expiration_date ? formatDate(code.expiration_date) : 'Never'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                            ${statusText}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button data-code-id="${code.id}" class="editCodeButton text-primary-600 dark:text-primary-400 hover:text-primary-900 dark:hover:text-primary-300 mr-3">Edit</button>
                        <button data-code-id="${code.id}" class="toggleCodeButton ${code.is_active ? 'text-yellow-600 dark:text-yellow-400 hover:text-yellow-900 dark:hover:text-yellow-300' : 'text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300'} mr-3">${code.is_active ? 'Deactivate' : 'Activate'}</button>
                        <button data-code-id="${code.id}" class="deleteCodeButton text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300">Delete</button>
                    </td>
                `;
                
                codesTable.appendChild(tr);
            });
            
            // Add event listeners for code actions
            document.querySelectorAll('.toggleCodeButton').forEach(button => {
                button.addEventListener('click', async () => {
                    const codeId = button.getAttribute('data-code-id');
                    const code = appState.codes.find(c => c.id === codeId);
                    
                    if (code) {
                        try {
                            await updateCode(codeId, { is_active: !code.is_active });
                            code.is_active = !code.is_active;
                            renderAdminCodes();
                            showNotification(`Code ${code.code} ${code.is_active ? 'activated' : 'deactivated'} successfully`);
                        } catch (error) {
                            showNotification('Error updating code: ' + error.message, 'error');
                        }
                    }
                });
            });
            
            document.querySelectorAll('.deleteCodeButton').forEach(button => {
                button.addEventListener('click', () => {
                    const codeId = button.getAttribute('data-code-id');
                    const code = appState.codes.find(c => c.id === codeId);
                    
                    if (code) {
                        showConfirmation(
                            'Delete Code',
                            `Are you sure you want to delete the code "${code.code}"? This action cannot be undone.`,
                            'Delete',
                            async () => {
                                try {
                                    await deleteCode(codeId);
                                    appState.codes = appState.codes.filter(c => c.id !== codeId);
                                    renderAdminCodes();
                                    showNotification(`Code ${code.code} deleted successfully`);
                                } catch (error) {
                                    showNotification('Error deleting code: ' + error.message, 'error');
                                }
                            }
                        );
                    }
                });
            });
            
            document.querySelectorAll('.editCodeButton').forEach(button => {
                button.addEventListener('click', () => {
                    const codeId = button.getAttribute('data-code-id');
                    const code = appState.codes.find(c => c.id === codeId);
                    
                    if (code) {
                        document.getElementById('codeInput').value = code.code;
                        document.getElementById('itemNameInput').value = code.item_name;
                        
                        populateEmojiCategories();
                        selectAppropriateCategory(code.item_graphic);
                        
                        document.getElementById('itemRaritySelect').value = code.rarity;
                        document.getElementById('expirationDateInput').value = code.expiration_date || '';
                        
                        updateItemPreview();
                        
                        document.getElementById('createCodeModal').classList.remove('hidden');
                        document.getElementById('modal-title').textContent = 'Edit Redemption Code';
                        document.getElementById('createCodeConfirmButtonText').textContent = 'Save Changes';
                        
                        const confirmButton = document.getElementById('createCodeConfirmButton');
                        const newButton = confirmButton.cloneNode(true);
                        confirmButton.parentNode.replaceChild(newButton, confirmButton);
                        
                        newButton.addEventListener('click', async () => {
                            const spinner = document.getElementById('createCodeConfirmButtonSpinner');
                            const buttonText = document.getElementById('createCodeConfirmButtonText');
                            
                            spinner.classList.remove('hidden');
                            buttonText.textContent = 'Saving...';
                            newButton.disabled = true;
                            
                            try {
                                const updatedCode = {
                                    code: document.getElementById('codeInput').value.trim(),
                                    item_name: document.getElementById('itemNameInput').value.trim(),
                                    item_graphic: document.querySelector('.emoji-item.selected')?.getAttribute('data-value') || code.item_graphic,
                                    rarity: document.getElementById('itemRaritySelect').value,
                                    expiration_date: document.getElementById('expirationDateInput').value || null
                                };
                                
                                if (!updatedCode.code || !updatedCode.item_name) {
                                    throw new Error('Please fill in all required fields');
                                }
                                
                                await updateCode(codeId, updatedCode);
                                
                                const index = appState.codes.findIndex(c => c.id === codeId);
                                if (index !== -1) {
                                    appState.codes[index] = { ...appState.codes[index], ...updatedCode };
                                }
                                
                                document.getElementById('createCodeModal').classList.add('hidden');
                                renderAdminCodes();
                                showNotification(`Code ${updatedCode.code} updated successfully`);
                            } catch (error) {
                                showNotification(error.message, 'error');
                            } finally {
                                spinner.classList.add('hidden');
                                buttonText.textContent = 'Save Changes';
                                newButton.disabled = false;
                            }
                        });
                    }
                });
            });
        }

        function selectAppropriateCategory(itemGraphic) {
            let foundCategory = null;
            let foundEmoji = null;
            
            for (const category in emojiCategories) {
                const emoji = emojiCategories[category].find(e => e.value === itemGraphic);
                if (emoji) {
                    foundCategory = category;
                    foundEmoji = emoji;
                    break;
                }
            }
            
            if (foundCategory && foundEmoji) {
                document.getElementById('itemCategorySelect').value = foundCategory;
                updateEmojiGrid(foundCategory);
                
                const emojiItems = document.querySelectorAll('.emoji-item');
                emojiItems.forEach(item => {
                    if (item.getAttribute('data-value') === itemGraphic) {
                        item.classList.add('selected', 'bg-primary-100', 'dark:bg-primary-900');
                    }
                });
            }
        }

        async function renderAdminUsers() {
            const usersTable = document.getElementById('usersTable');
            
            if (appState.users.length === 0) {
                usersTable.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-gray-500 dark:text-gray-400 italic">No users found</td>
                    </tr>
                `;
                return;
            }
            
            usersTable.innerHTML = '';
            
            appState.users.forEach(user => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
                
                // Count user's collectibles - for simplicity, we'll show 0 for other users
                const collectiblesCount = user.id === appState.currentUser.id ? appState.collectibles.length : 0;
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-primary-200 dark:bg-primary-800 flex items-center justify-center shadow-sm">
                                <span class="text-primary-700 dark:text-primary-300 font-medium">${user.username.charAt(0).toUpperCase()}</span>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900 dark:text-white">${user.username}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500 dark:text-gray-400">Hidden</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.role === 'admin' ? 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200' : 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200'}">
                            ${user.role.charAt(0).toUpperCase() + user.role.slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">${collectiblesCount}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button data-user-id="${user.id}" class="viewUserButton text-primary-600 dark:text-primary-400 hover:text-primary-900 dark:hover:text-primary-300 mr-3">View</button>
                        <button data-user-id="${user.id}" class="toggleRoleButton ${user.role === 'admin' ? 'text-yellow-600 dark:text-yellow-400 hover:text-yellow-900 dark:hover:text-yellow-300' : 'text-purple-600 dark:text-purple-400 hover:text-purple-900 dark:hover:text-purple-300'} mr-3">${user.role === 'admin' ? 'Remove Admin' : 'Make Admin'}</button>
                    </td>
                `;
                
                usersTable.appendChild(tr);
            });
            
            document.querySelectorAll('.toggleRoleButton').forEach(button => {
                button.addEventListener('click', async () => {
                    const userId = button.getAttribute('data-user-id');
                    const user = appState.users.find(u => u.id === userId);
                    
                    if (user) {
                        if (user.id === appState.currentUser.id) {
                            showNotification('You cannot change your own role', 'error');
                            return;
                        }
                        
                        try {
                            const newRole = user.role === 'admin' ? 'user' : 'admin';
                            await updateUserProfile(userId, { role: newRole });
                            user.role = newRole;
                            renderAdminUsers();
                            showNotification(`User ${user.username} is now ${user.role}`);
                        } catch (error) {
                            showNotification('Error updating user role: ' + error.message, 'error');
                        }
                    }
                });
            });
            
            document.querySelectorAll('.viewUserButton').forEach(button => {
                button.addEventListener('click', () => {
                    const userId = button.getAttribute('data-user-id');
                    const user = appState.users.find(u => u.id === userId);
                    
                    if (user) {
                        const collectiblesCount = user.id === appState.currentUser.id ? appState.collectibles.length : 0;
                        
                        showConfirmation(
                            `User Details: ${user.username}`,
                            `Role: ${user.role}
                            Created: ${formatDate(user.created_at || new Date())}
                            Total Collectibles: ${collectiblesCount}`,
                            'Close',
                            () => {}
                        );
                    }
                });
            });
        }

        function renderProfileView() {
            if (!appState.currentUser) return;
            
            document.getElementById('profileUserInitial').textContent = appState.userProfile.username.charAt(0).toUpperCase();
            document.getElementById('profileUsername').textContent = appState.userProfile.username;
            document.getElementById('profileEmail').textContent = appState.currentUser.email;
            document.getElementById('profileRole').textContent = appState.userProfile.role.charAt(0).toUpperCase() + appState.userProfile.role.slice(1);
            
            const collectiblesCount = appState.collectibles.length;
            document.getElementById('profileCollectibles').textContent = collectiblesCount;
            
            document.getElementById('profileCreatedAt').textContent = formatDate(appState.userProfile.created_at || new Date());
            
            document.getElementById('updateUsername').value = appState.userProfile.username;
        }

        function renderSettingsView() {
            const settingsDarkModeToggle = document.getElementById('settingsDarkModeToggle');
            
            const isDarkMode = document.documentElement.classList.contains('dark');
            
            settingsDarkModeToggle.classList.toggle('bg-primary-500', isDarkMode);
            settingsDarkModeToggle.classList.toggle('bg-gray-200', !isDarkMode);
            settingsDarkModeToggle.querySelector('span').classList.toggle('translate-x-5', isDarkMode);
        }

        function updateItemPreview() {
            const itemName = document.getElementById('itemNameInput').value || 'Item Name';
            const selectedEmoji = document.querySelector('.emoji-item.selected');
            const itemGraphic = selectedEmoji ? selectedEmoji.getAttribute('data-value') : 'shield';
            const itemRarity = document.getElementById('itemRaritySelect').value;
            
            const previewContainer = document.getElementById('itemPreview');
            
            let glitterHtml = '';
            if (itemRarity === 'legendary' || itemRarity === 'mythic') {
                for (let i = 0; i < 5; i++) {
                    const top = Math.floor(Math.random() * 80) + 10;
                    const left = Math.floor(Math.random() * 80) + 10;
                    const delay = Math.random() * 2;
                    glitterHtml += `<div class="collectible-glitter" style="top: ${top}%; left: ${left}%; animation-delay: ${delay}s"></div>`;
                }
            }
            
            previewContainer.innerHTML = `
                <div class="collectible-card relative w-32 h-40 rounded-lg overflow-hidden shadow-md">
                    <div class="absolute inset-0 rarity-${itemRarity}"></div>
                    <div class="card-shine"></div>
                    <div class="card-border"></div>
                    ${glitterHtml}
                    <div class="relative flex flex-col items-center justify-center h-full p-2">
                        <div class="w-16 h-16 bg-white dark:bg-gray-700 rounded-full flex items-center justify-center shadow-sm">
                            <div class="collectible-icon text-center text-3xl">
                                ${getEmojiByValue(itemGraphic)}
                            </div>
                        </div>
                        <div class="mt-2 text-center">
                            <div class="font-medium text-xs text-gray-900 dark:text-white truncate max-w-full">${itemName}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                <span class="badge-${itemRarity} rarity-badge">${itemRarity}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            const segments = 3;
            const segmentLength = 4;
            
            for (let s = 0; s < segments; s++) {
                for (let i = 0; i < segmentLength; i++) {
                    result += characters.charAt(Math.floor(Math.random() * characters.length));
                }
                if (s < segments - 1) result += '-';
            }
            
            return result;
        }

        function populateEmojiCategories() {
            const categorySelect = document.getElementById('itemCategorySelect');
            categorySelect.innerHTML = '';
            
            for (const category in emojiCategories) {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            }
            
            const firstCategory = Object.keys(emojiCategories)[0];
            updateEmojiGrid(firstCategory);
            
            categorySelect.addEventListener('change', (e) => {
                const selectedCategory = e.target.value;
                updateEmojiGrid(selectedCategory);
            });
            
            const searchInput = document.getElementById('emojiSearch');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.length === 0) {
                    updateEmojiGrid(categorySelect.value);
                } else {
                    searchEmojis(searchTerm);
                }
            });
        }
        
        function updateEmojiGrid(category) {
            const emojiPicker = document.getElementById('emojiPicker');
            emojiPicker.innerHTML = '';
            
            const emojis = emojiCategories[category];
            
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'emoji-category';
            
            const emojiGrid = document.createElement('div');
            emojiGrid.className = 'emoji-grid';
            
            emojis.forEach(emoji => {
                const emojiItem = document.createElement('div');
                emojiItem.className = 'emoji-item';
                emojiItem.setAttribute('data-value', emoji.value);
                emojiItem.innerHTML = `
                    <div class="emoji-icon">${emoji.emoji}</div>
                    <div class="emoji-name">${emoji.name}</div>
                `;
                
                emojiItem.addEventListener('click', () => {
                    document.querySelectorAll('.emoji-item').forEach(item => {
                        item.classList.remove('selected', 'bg-primary-100', 'dark:bg-primary-900');
                    });
                    
                    emojiItem.classList.add('selected', 'bg-primary-100', 'dark:bg-primary-900');
                    updateItemPreview();
                });
                
                emojiGrid.appendChild(emojiItem);
            });
            
            categoryDiv.appendChild(emojiGrid);
            emojiPicker.appendChild(categoryDiv);
        }
        
        function searchEmojis(searchTerm) {
            const emojiPicker = document.getElementById('emojiPicker');
            emojiPicker.innerHTML = '';
            
            const searchResults = [];
            
            for (const category in emojiCategories) {
                emojiCategories[category].forEach(emoji => {
                    if (emoji.name.toLowerCase().includes(searchTerm) || 
                        emoji.value.toLowerCase().includes(searchTerm) ||
                        category.toLowerCase().includes(searchTerm)) {
                        searchResults.push({ ...emoji, category });
                    }
                });
            }
            
            if (searchResults.length === 0) {
                emojiPicker.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400 p-4">No emojis found matching "${searchTerm}"</p>`;
                return;
            }
            
            const groupedResults = {};
            searchResults.forEach(result => {
                if (!groupedResults[result.category]) {
                    groupedResults[result.category] = [];
                }
                groupedResults[result.category].push(result);
            });
            
            for (const category in groupedResults) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'emoji-category mb-4';
                
                const categoryTitle = document.createElement('h3');
                categoryTitle.className = 'text-sm font-medium text-gray-700 dark:text-gray-300 mb-2';
                categoryTitle.textContent = category;
                
                const emojiGrid = document.createElement('div');
                emojiGrid.className = 'emoji-grid';
                
                groupedResults[category].forEach(emoji => {
                    const emojiItem = document.createElement('div');
                    emojiItem.className = 'emoji-item';
                    emojiItem.setAttribute('data-value', emoji.value);
                    emojiItem.innerHTML = `
                        <div class="emoji-icon">${emoji.emoji}</div>
                        <div class="emoji-name">${emoji.name}</div>
                    `;
                    
                    emojiItem.addEventListener('click', () => {
                        document.querySelectorAll('.emoji-item').forEach(item => {
                            item.classList.remove('selected', 'bg-primary-100', 'dark:bg-primary-900');
                        });
                        
                        emojiItem.classList.add('selected', 'bg-primary-100', 'dark:bg-primary-900');
                        updateItemPreview();
                    });
                    
                    emojiGrid.appendChild(emojiItem);
                });
                
                categoryDiv.appendChild(categoryTitle);
                categoryDiv.appendChild(emojiGrid);
                emojiPicker.appendChild(categoryDiv);
            }
        }

        async function switchView(view) {
            // Hide all views
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('collectionView').classList.add('hidden');
            document.getElementById('redeemCodeView').classList.add('hidden');
            document.getElementById('adminPanelView').classList.add('hidden');
            document.getElementById('profileView').classList.add('hidden');
            document.getElementById('settingsView').classList.add('hidden');
            
            // Show the requested view
            document.getElementById(`${view}View`).classList.remove('hidden');
            
            // Update navigation styling - desktop
            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('border-primary-500', 'text-gray-900', 'dark:text-white');
                link.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-300');
            });
            
            if (['dashboard', 'collection', 'redeem'].includes(view)) {
                document.getElementById(`nav-${view}`).classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-300');
                document.getElementById(`nav-${view}`).classList.add('border-primary-500', 'text-gray-900', 'dark:text-white');
            }
            
            // Update navigation styling - mobile
            document.querySelectorAll('#mobileMenu a').forEach(link => {
                link.classList.remove('bg-primary-50', 'dark:bg-primary-900', 'border-primary-500', 'text-primary-700', 'dark:text-primary-300');
                link.classList.add('border-transparent', 'text-gray-600', 'dark:text-gray-300');
            });
            
            if (['dashboard', 'collection', 'redeem'].includes(view)) {
                document.getElementById(`mobile-nav-${view}`).classList.remove('border-transparent', 'text-gray-600', 'dark:text-gray-300');
                document.getElementById(`mobile-nav-${view}`).classList.add('bg-primary-50', 'dark:bg-primary-900', 'border-primary-500', 'text-primary-700', 'dark:text-primary-300');
            }
            
            appState.currentView = view;
            
            // Perform view-specific initializations
            if (view === 'collection') {
                renderUserCollectionStats();
                renderCollection();
            } else if (view === 'dashboard') {
                await updateDashboardStats();
                renderActivityFeed();
                renderFeaturedCollectibles();
            } else if (view === 'redeemCode') {
                renderRedemptionHistory();
            } else if (view === 'adminPanel') {
                await renderAdminCodes();
                await renderAdminUsers();
            } else if (view === 'profile') {
                renderProfileView();
            } else if (view === 'settings') {
                renderSettingsView();
            }
        }

        // Load all user data
        async function loadUserData() {
            if (!appState.currentUser) return;
            
            try {
                // Load user profile
                appState.userProfile = await getUserProfile(appState.currentUser.id);
                appState.isAdmin = appState.userProfile.role === 'admin';
                
                // Load user's collectibles
                appState.collectibles = await loadUserCollectibles(appState.currentUser.id);
                
                // Load user's activities
                appState.activities = await loadUserActivities(appState.currentUser.id);
                
                // Load user's redemption history
                appState.redemptionHistory = await loadUserRedemptionHistory(appState.currentUser.id);
                
                // Load codes (for featured collectibles and admin panel)
                appState.codes = await loadCodes();
                
                // Load all users if admin
                if (appState.isAdmin) {
                    appState.users = await getAllUsers();
                }
                
                return true;
            } catch (error) {
                console.error('Error loading user data:', error);
                showNotification('Error loading user data: ' + error.message, 'error');
                return false;
            }
        }

        // Event handlers
        function setupEventListeners() {
            // Dark mode toggle
            const darkModeToggles = [
                document.getElementById('darkModeToggle'),
                document.getElementById('headerDarkModeToggle'),
                document.getElementById('mobileDarkModeToggle')
            ];
            
            darkModeToggles.forEach(toggle => {
                if (toggle) {
                    toggle.addEventListener('click', () => {
                        document.documentElement.classList.toggle('dark');
                    });
                }
            });
            
            // Navigation
            document.getElementById('nav-dashboard').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('dashboard');
            });
            
            document.getElementById('nav-collection').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('collection');
            });
            
            document.getElementById('nav-redeem').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('redeemCode');
            });
            
            // Mobile navigation
            document.getElementById('mobile-nav-dashboard').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('dashboard');
                document.getElementById('mobileMenu').classList.add('hidden');
            });
            
            document.getElementById('mobile-nav-collection').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('collection');
                document.getElementById('mobileMenu').classList.add('hidden');
            });
            
            document.getElementById('mobile-nav-redeem').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('redeemCode');
                document.getElementById('mobileMenu').classList.add('hidden');
            });
            
            // Mobile menu toggle
            document.getElementById('mobileMenuButton').addEventListener('click', () => {
                const mobileMenu = document.getElementById('mobileMenu');
                mobileMenu.classList.toggle('hidden');
                
                const isExpanded = mobileMenu.classList.contains('hidden') ? 'false' : 'true';
                document.getElementById('mobileMenuButton').setAttribute('aria-expanded', isExpanded);
                
                const openIcon = document.getElementById('mobileMenuButton').querySelector('svg.block');
                const closeIcon = document.getElementById('mobileMenuButton').querySelector('svg.hidden');
                
                openIcon.classList.toggle('block');
                openIcon.classList.toggle('hidden');
                closeIcon.classList.toggle('block');
                closeIcon.classList.toggle('hidden');
            });
            
            // User menu toggle
            document.getElementById('userMenuButton').addEventListener('click', () => {
                document.getElementById('userMenu').classList.toggle('hidden');
            });
            
            // Handle clicks outside the user menu to close it
            document.addEventListener('click', (e) => {
                const userMenu = document.getElementById('userMenu');
                const userMenuButton = document.getElementById('userMenuButton');
                
                if (!userMenu.classList.contains('hidden') && 
                    !userMenuButton.contains(e.target) && 
                    !userMenu.contains(e.target)) {
                    userMenu.classList.add('hidden');
                }
            });
            
            // Collection filter
            document.getElementById('collectionFilterRarity').addEventListener('change', (e) => {
                renderCollection(e.target.value);
            });
            
            // Login/register toggle
            document.getElementById('showRegisterForm').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
            });
            
            document.getElementById('showLoginForm').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            });
            
            // Login form
            document.getElementById('loginButton').addEventListener('click', async () => {
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    showNotification('Please enter both email and password', 'error');
                    return;
                }
                
                const spinner = document.getElementById('loginButtonSpinner');
                const buttonText = document.getElementById('loginButtonText');
                
                spinner.classList.remove('hidden');
                buttonText.textContent = 'Signing in...';
                document.getElementById('loginButton').disabled = true;
                
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password,
                    });
                    
                    if (error) throw error;
                    
                    appState.currentUser = data.user;
                    
                    // Load user data
                    const dataLoaded = await loadUserData();
                    if (!dataLoaded) {
                        throw new Error('Failed to load user data');
                    }
                    
                    // Update UI for logged in user
                    document.getElementById('authScreen').classList.add('hidden');
                    document.getElementById('userInitial').textContent = appState.userProfile.username.charAt(0).toUpperCase();
                    document.getElementById('mobileUserInitial').textContent = appState.userProfile.username.charAt(0).toUpperCase();
                    document.getElementById('mobileUsername').textContent = appState.userProfile.username;
                    document.getElementById('mobileUserEmail').textContent = appState.currentUser.email;
                    
                    // Show admin panel link if user is admin
                    if (appState.isAdmin) {
                        document.getElementById('menu-admin-panel').classList.remove('hidden');
                        document.getElementById('mobile-menu-admin-panel').classList.remove('hidden');
                    } else {
                        document.getElementById('menu-admin-panel').classList.add('hidden');
                        document.getElementById('mobile-menu-admin-panel').classList.add('hidden');
                    }
                    
                    // Initialize dashboard
                    switchView('dashboard');
                    
                    showNotification(`Welcome back, ${appState.userProfile.username}!`);
                } catch (error) {
                    showNotification('Error signing in: ' + error.message, 'error');
                } finally {
                    spinner.classList.add('hidden');
                    buttonText.textContent = 'Sign In';
                    document.getElementById('loginButton').disabled = false;
                }
            });
            
            // Register form
            document.getElementById('registerButton').addEventListener('click', async () => {
                const username = document.getElementById('registerUsername').value.trim();
                const email = document.getElementById('registerEmail').value.trim();
                const password = document.getElementById('registerPassword').value;
                
                if (!username || !email || !password) {
                    showNotification('Please fill in all fields', 'error');
                    return;
                }
                
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showNotification('Please enter a valid email address', 'error');
                    return;
                }
                
                const spinner = document.getElementById('registerButtonSpinner');
                const buttonText = document.getElementById('registerButtonText');
                
                spinner.classList.remove('hidden');
                buttonText.textContent = 'Creating account...';
                document.getElementById('registerButton').disabled = true;
                
               try {
    const { data, error } = await supabase.auth.signUp({
        email: email,
        password: password,
        options: {
            data: {
                username: username
            },
            // Add the emailRedirectTo property here
            emailRedirectTo: 'https://4eudh.github.io/collectibles/' 
        }
    });
    // ... rest of your code
}

                    
                    if (error) throw error;
                    
                    if (data.user && !data.session) {
                        showNotification('Please check your email to confirm your account before signing in', 'error');
                        return;
                    }
                    
                    if (data.user && data.session) {
                        appState.currentUser = data.user;
                        
                        // Create user profile
                        await createUserProfile(data.user, username);
                        
                        // Load user data
                        const dataLoaded = await loadUserData();
                        if (!dataLoaded) {
                            throw new Error('Failed to load user data');
                        }
                        
                        // Update UI for logged in user
                        document.getElementById('authScreen').classList.add('hidden');
                        document.getElementById('userInitial').textContent = username.charAt(0).toUpperCase();
                        document.getElementById('mobileUserInitial').textContent = username.charAt(0).toUpperCase();
                        document.getElementById('mobileUsername').textContent = username;
                        document.getElementById('mobileUserEmail').textContent = email;
                        
                        // Hide admin panel link for new users
                        document.getElementById('menu-admin-panel').classList.add('hidden');
                        document.getElementById('mobile-menu-admin-panel').classList.add('hidden');
                        
                        // Initialize dashboard
                        switchView('dashboard');
                        
                        showNotification(`Welcome to Collectible Realm, ${username}!`);
                    }
                } catch (error) {
                    showNotification('Error creating account: ' + error.message, 'error');
                } finally {
                    spinner.classList.add('hidden');
                    buttonText.textContent = 'Register';
                    document.getElementById('registerButton').disabled = false;
                }
            });

            // Redeem code button
            document.getElementById('redeemCodeButton').addEventListener('click', async () => {
                const codeInput = document.getElementById('redeemCode').value.trim();
                const resultDiv = document.getElementById('redeemResult');
                
                if (!codeInput) {
                    resultDiv.innerHTML = 'Please enter a code';
                    resultDiv.className = 'mt-4 p-4 rounded-md bg-red-50 dark:bg-red-900 text-red-800 dark:text-red-100';
                    resultDiv.classList.remove('hidden');
                    return;
                }
                
                const spinner = document.getElementById('redeemCodeButtonSpinner');
                const buttonText = document.getElementById('redeemCodeButtonText');
                
                spinner.classList.remove('hidden');
                buttonText.textContent = 'Redeeming...';
                document.getElementById('redeemCodeButton').disabled = true;
                
                try {
                    // Check if code exists and is valid
                    const code = appState.codes.find(c => c.code === codeInput);
                    
                    if (!code) {
                        throw new Error('Invalid code. Please check and try again.');
                    }
                    
                    if (!code.is_active) {
                        throw new Error('This code is no longer active.');
                    }
                    
                    if (code.expiration_date && new Date(code.expiration_date) < new Date()) {
                        throw new Error('This code has expired.');
                    }
                    
                    // Check if user already redeemed this code
                    const alreadyRedeemed = appState.collectibles.some(c => c.code_id === code.id);
                    
                    if (alreadyRedeemed) {
                        throw new Error('You have already redeemed this code.');
                    }
                    
                    // Redeem the code
                    const newCollectible = {
                        user_id: appState.currentUser.id,
                        item_name: code.item_name,
                        item_graphic: code.item_graphic,
                        rarity: code.rarity,
                        code_id: code.id
                    };
                    
                    await createCollectible(newCollectible);
                    
                    // Add to redemption history
                    const redemptionData = {
                        user_id: appState.currentUser.id,
                        code: code.code,
                        items: [code.item_name],
                        rarity: code.rarity
                    };
                    
                    await createRedemptionHistory(redemptionData);
                    
                    // Add to activities
                    const activityData = {
                        user_id: appState.currentUser.id,
                        action: 'redeemed',
                        item_name: code.item_name,
                        item_rarity: code.rarity
                    };
                    
                    await createActivity(activityData);
                    
                    // Update local state
                    appState.collectibles.push({
                        ...newCollectible,
                        id: 'temp-' + Date.now(), // Temporary ID
                        acquired_date: new Date().toISOString()
                    });
                    
                    appState.redemptionHistory.push({
                        ...redemptionData,
                        id: 'temp-' + Date.now(),
                        created_at: new Date().toISOString()
                    });
                    
                    appState.activities.unshift({
                        ...activityData,
                        id: 'temp-' + Date.now(),
                        created_at: new Date().toISOString()
                    });
                    
                    // Create glitter elements for legendary and mythic items
                    let glitterHtml = '';
                    if (code.rarity === 'legendary' || code.rarity === 'mythic') {
                        for (let i = 0; i < 8; i++) {
                            const top = Math.floor(Math.random() * 80) + 10;
                            const left = Math.floor(Math.random() * 80) + 10;
                            const delay = Math.random() * 2;
                            glitterHtml += `<div class="collectible-glitter" style="top: ${top}%; left: ${left}%; animation-delay: ${delay}s"></div>`;
                        }
                    }
                    
                    // Update UI with an enhanced and animated redemption result
                    resultDiv.innerHTML = `
                        <div class="flex flex-col items-center">
                            <div class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <span class="flex items-center">
                                    <svg class="h-6 w-6 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Code redeemed successfully!
                                </span>
                            </div>
                            <div class="collectible-card redeemed-collectible relative w-40 h-52 rounded-lg overflow-hidden shadow-lg mb-5">
                                <div class="absolute inset-0 rarity-${code.rarity}"></div>
                                <div class="card-shine"></div>
                                <div class="card-border"></div>
                                ${glitterHtml}
                                <div class="relative flex flex-col items-center justify-center h-full p-3">
                                    <div class="w-24 h-24 bg-white dark:bg-gray-700 rounded-full flex items-center justify-center mb-3 shadow-lg">
                                        <div class="collectible-icon text-center text-4xl">
                                            ${getEmojiByValue(code.item_graphic)}
                                        </div>
                                    </div>
                                    <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-1">${code.item_name}</h3>
                                    <div class="mb-1">
                                        <span class="badge-${code.rarity} rarity-badge">${code.rarity}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-3 w-full max-w-xs">
                                <button onclick="switchView('collection')" class="flex-1 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md transition-colors">
                                    View Collection
                                </button>
                                <button id="redeemAnotherBtn" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md transition-colors">
                                    Redeem Another
                                </button>
                            </div>
                        </div>
                    `;
                    resultDiv.className = 'mt-4 p-6 rounded-md bg-green-50 dark:bg-green-900 text-green-800 dark:text-green-100';
                    resultDiv.classList.remove('hidden');
                    
                    // Clear the input
                    document.getElementById('redeemCode').value = '';
                    
                    // Update redemption history
                    renderRedemptionHistory();
                    
                    // Add event listener to "Redeem Another" button
                    document.getElementById('redeemAnotherBtn').addEventListener('click', () => {
                        document.getElementById('redeemResult').classList.add('hidden');
                        document.getElementById('redeemCode').focus();
                    });
                    
                    // Show notification
                    showNotification(`You've successfully redeemed ${code.item_name}!`);
                    
                } catch (error) {
                    resultDiv.innerHTML = error.message;
                    resultDiv.className = 'mt-4 p-4 rounded-md bg-red-50 dark:bg-red-900 text-red-800 dark:text-red-100';
                    resultDiv.classList.remove('hidden');
                } finally {
                    spinner.classList.add('hidden');
                    buttonText.textContent = 'Redeem Code';
                    document.getElementById('redeemCodeButton').disabled = false;
                }
            });

            // Admin panel - create code button
            document.getElementById('createCodeButton').addEventListener('click', () => {
                document.getElementById('codeInput').value = '';
                document.getElementById('itemNameInput').value = '';
                document.getElementById('itemRaritySelect').value = 'common';
                document.getElementById('expirationDateInput').value = '';
                
                populateEmojiCategories();
                updateItemPreview();
                
                document.getElementById('modal-title').textContent = 'Create New Redemption Code';
                document.getElementById('createCodeConfirmButtonText').textContent = 'Create';
                
                document.getElementById('createCodeModal').classList.remove('hidden');
                
                const confirmButton = document.getElementById('createCodeConfirmButton');
                const newButton = confirmButton.cloneNode(true);
                confirmButton.parentNode.replaceChild(newButton, confirmButton);
                
                newButton.addEventListener('click', async () => {
                    const code = document.getElementById('codeInput').value.trim();
                    const itemName = document.getElementById('itemNameInput').value.trim();
                    const selectedEmoji = document.querySelector('.emoji-item.selected');
                    const itemGraphic = selectedEmoji ? selectedEmoji.getAttribute('data-value') : 'shield';
                    const itemRarity = document.getElementById('itemRaritySelect').value;
                    const expirationDate = document.getElementById('expirationDateInput').value || null;
                    
                    if (!code || !itemName) {
                        showNotification('Please fill in all required fields', 'error');
                        return;
                    }
                    
                    if (appState.codes.some(c => c.code === code)) {
                        showNotification('This code already exists', 'error');
                        return;
                    }
                    
                    const spinner = document.getElementById('createCodeConfirmButtonSpinner');
                    const buttonText = document.getElementById('createCodeConfirmButtonText');
                    
                    spinner.classList.remove('hidden');
                    buttonText.textContent = 'Creating...';
                    newButton.disabled = true;
                    
                    try {
                        const newCode = {
                            code,
                            item_name: itemName,
                            item_graphic: itemGraphic,
                            rarity: itemRarity,
                            expiration_date: expirationDate,
                            is_active: true
                        };
                        
                        await createCode(newCode);
                        
                        appState.codes.unshift({
                            ...newCode,
                            id: 'temp-' + Date.now(),
                            created_at: new Date().toISOString()
                        });
                        
                        document.getElementById('createCodeModal').classList.add('hidden');
                        renderAdminCodes();
                        showNotification(`Code ${code} created successfully`);
                    } catch (error) {
                        showNotification('Error creating code: ' + error.message, 'error');
                    } finally {
                        spinner.classList.add('hidden');
                        buttonText.textContent = 'Create';
                        newButton.disabled = false;
                    }
                });
            });
            
            // Generate random code
            document.getElementById('generateCodeButton').addEventListener('click', () => {
                document.getElementById('codeInput').value = generateCode();
            });
            
            // Admin panel modal close button
            document.getElementById('createCodeCancelButton').addEventListener('click', () => {
                document.getElementById('createCodeModal').classList.add('hidden');
            });
            
            // Collectible detail modal close button
            document.getElementById('collectibleDetailCloseButton').addEventListener('click', () => {
                document.getElementById('collectibleDetailModal').classList.add('hidden');
            });
            
            // Item preview live update
            document.getElementById('itemNameInput').addEventListener('input', updateItemPreview);
            document.getElementById('itemRaritySelect').addEventListener('change', updateItemPreview);
            
            // Admin panel link
            document.getElementById('menu-admin-panel').addEventListener('click', (e) => {
                e.preventDefault();
                if (appState.isAdmin) {
                    switchView('adminPanel');
                    document.getElementById('userMenu').classList.add('hidden');
                } else {
                    showNotification('You do not have admin privileges', 'error');
                }
            });
            
            document.getElementById('mobile-menu-admin-panel').addEventListener('click', (e) => {
                e.preventDefault();
                if (appState.isAdmin) {
                    switchView('adminPanel');
                    document.getElementById('mobileMenu').classList.add('hidden');
                } else {
                    showNotification('You do not have admin privileges', 'error');
                }
            });

            // Profile menu items
            document.getElementById('menu-profile').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('profile');
                document.getElementById('userMenu').classList.add('hidden');
            });
            
            document.getElementById('mobile-menu-profile').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('profile');
                document.getElementById('mobileMenu').classList.add('hidden');
            });
            
            // Settings menu items
            document.getElementById('menu-settings').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('settings');
                document.getElementById('userMenu').classList.add('hidden');
            });
            
            document.getElementById('mobile-menu-settings').addEventListener('click', (e) => {
                e.preventDefault();
                switchView('settings');
                document.getElementById('mobileMenu').classList.add('hidden');
            });
            
            // Update profile button
            document.getElementById('updateProfileButton').addEventListener('click', async () => {
                const newUsername = document.getElementById('updateUsername').value.trim();
                
                if (!newUsername) {
                    showNotification('Username is required', 'error');
                    return;
                }
                
                const spinner = document.getElementById('updateProfileButtonSpinner');
                const buttonText = document.getElementById('updateProfileButtonText');
                
                spinner.classList.remove('hidden');
                buttonText.textContent = 'Updating...';
                document.getElementById('updateProfileButton').disabled = true;
                
                try {
                    await updateUserProfile(appState.currentUser.id, { username: newUsername });
                    
                    // Update local state
                    appState.userProfile.username = newUsername;
                    
                    // Update the UI
                    document.getElementById('userInitial').textContent = newUsername.charAt(0).toUpperCase();
                    document.getElementById('mobileUserInitial').textContent = newUsername.charAt(0).toUpperCase();
                    document.getElementById('mobileUsername').textContent = newUsername;
                    
                    // Update profile view
                    renderProfileView();
                    
                    showNotification('Profile updated successfully');
                } catch (error) {
                    showNotification('Error updating profile: ' + error.message, 'error');
                } finally {
                    spinner.classList.add('hidden');
                    buttonText.textContent = 'Update Profile';
                    document.getElementById('updateProfileButton').disabled = false;
                }
            });
            
            // Settings toggles
            document.getElementById('settingsDarkModeToggle').addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                const isDarkMode = document.documentElement.classList.contains('dark');
                
                // Update toggle appearance
                document.getElementById('settingsDarkModeToggle').classList.toggle('bg-primary-500', isDarkMode);
                document.getElementById('settingsDarkModeToggle').classList.toggle('bg-gray-200', !isDarkMode);
                document.getElementById('settingsDarkModeToggle').querySelector('span').classList.toggle('translate-x-5', isDarkMode);
            });
            
            // Data management
            document.getElementById('exportDataButton').addEventListener('click', async () => {
                try {
                    const exportData = {
                        user: {
                            username: appState.userProfile.username,
                            email: appState.currentUser.email,
                            createdAt: appState.userProfile.created_at
                        },
                        collectibles: appState.collectibles,
                        redemptionHistory: appState.redemptionHistory,
                        activities: appState.activities,
                        exportDate: new Date().toISOString()
                    };
                    
                    showConfirmation(
                        'Export Data',
                        'Your data is ready for export. In a real application, you would be able to download this as a file.',
                        'Close',
                        () => {}
                    );
                } catch (error) {
                    showNotification('Error exporting data: ' + error.message, 'error');
                }
            });
            
            document.getElementById('clearDataButton').addEventListener('click', () => {
                showConfirmation(
                    'Clear All Data',
                    'Are you sure you want to clear all your data? This will remove all your collectibles, redemption history, and activities. This action cannot be undone.',
                    'Clear Data',
                    async () => {
                        try {
                            // In a real implementation, you'd need to delete from the database
                            // For now, we'll just clear the local state
                            appState.collectibles = [];
                            appState.redemptionHistory = [];
                            appState.activities = [];
                            
                            switchView('dashboard');
                            showNotification('All your data has been cleared');
                        } catch (error) {
                            showNotification('Error clearing data: ' + error.message, 'error');
                        }
                    }
                );
            });

            // Logout
            document.getElementById('menu-sign-out').addEventListener('click', async (e) => {
                e.preventDefault();
                await logout();
            });
            
            document.getElementById('mobile-menu-sign-out').addEventListener('click', async (e) => {
                e.preventDefault();
                await logout();
            });
        }

        async function logout() {
            try {
                await supabase.auth.signOut();
                
                // Clear application state
                appState.currentUser = null;
                appState.userProfile = null;
                appState.isAdmin = false;
                appState.codes = [];
                appState.collectibles = [];
                appState.activities = [];
                appState.redemptionHistory = [];
                appState.users = [];
                
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('authScreen').classList.add('flex');
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('userMenu').classList.add('hidden');
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                
                showNotification('You have been signed out');
            } catch (error) {
                showNotification('Error signing out: ' + error.message, 'error');
            }
        }

        // Initialize the application
        async function initApp() {
            if (SUPABASE_URL === 'YOUR_SUPABASE_PROJECT_URL_HERE' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY_HERE') {
                document.getElementById('loadingScreen').classList.add('hidden');
                showNotification('Please configure your Supabase credentials in the code', 'error');
                return;
            }
            
            // Setup event listeners
            setupEventListeners();
            
            try {
                // Check if user is already signed in
                const { data: { session } } = await supabase.auth.getSession();
                
                if (session?.user) {
                    appState.currentUser = session.user;
                    
                    // Load user data
                    const dataLoaded = await loadUserData();
                    if (dataLoaded) {
                        // User is logged in and data loaded successfully
                        document.getElementById('userInitial').textContent = appState.userProfile.username.charAt(0).toUpperCase();
                        document.getElementById('mobileUserInitial').textContent = appState.userProfile.username.charAt(0).toUpperCase();
                        document.getElementById('mobileUsername').textContent = appState.userProfile.username;
                        document.getElementById('mobileUserEmail').textContent = appState.currentUser.email;
                        
                        // Show admin panel link if user is admin
                        if (appState.isAdmin) {
                            document.getElementById('menu-admin-panel').classList.remove('hidden');
                            document.getElementById('mobile-menu-admin-panel').classList.remove('hidden');
                        } else {
                            document.getElementById('menu-admin-panel').classList.add('hidden');
                            document.getElementById('mobile-menu-admin-panel').classList.add('hidden');
                        }
                        
                        // Show dashboard
                        document.getElementById('loadingScreen').classList.add('hidden');
                        switchView('dashboard');
                    } else {
                        // Failed to load user data, show auth screen
                        document.getElementById('loadingScreen').classList.add('hidden');
                        document.getElementById('authScreen').classList.remove('hidden');
                        document.getElementById('authScreen').classList.add('flex');
                    }
                } else {
                    // No user is logged in
                    document.getElementById('loadingScreen').classList.add('hidden');
                    document.getElementById('authScreen').classList.remove('hidden');
                    document.getElementById('authScreen').classList.add('flex');
                }
            } catch (error) {
                console.error('Error initializing app:', error);
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('authScreen').classList.add('flex');
                showNotification('Error loading application: ' + error.message, 'error');
            }
        }

        // Start the app after a short delay to simulate loading
        setTimeout(initApp, 1000);
    </script>
</body>
</html>
